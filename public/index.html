<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Merve & ≈û√ºkr√º Ni≈üanƒ± | Fotoƒüraf Y√ºkle</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to right, #fdfcfb, #e2d1c3);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 60px;
      color: #333;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }

    p {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .remove-btn.disabled {
      pointer-events: none;
      opacity: 0.3;
      cursor: not-allowed;
    }

    #fileCount {
      font-size: 16px;
      color: #444;
      margin-bottom: 20px;
    }

    #drop-zone {
      border: 2px dashed #aaa;
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s ease;
    }

    input[type="file"] {
      display: none;
    }

    .btn {
      padding: 10px 25px;
      margin: 8px;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: 0.3s;
    }

    #selectBtn {
      background: #888;
      color: #fff;
    }

    #selectBtn:hover {
      background: #555;
    }

    .gallery-item input[type="checkbox"] {
      transform: scale(1.5);
    }

    #uploadBtn {
      background: #222;
      color: #fff;
    }

    #uploadBtn:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }

    #status {
      margin-top: 20px;
      font-weight: bold;
    }

    #preview-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .preview {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      background: #f9f9f9;
    }

    .preview img,
    .preview video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-btn {
      position: absolute;
      top: 3px;
      right: 6px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 14px;
      cursor: pointer;
    }

    #success-message {
      background-color: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
    }

    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #555;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-left: 10px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const extensions = ["jpg", "jpeg", "png", "webp", "gif"];
      for (const ext of extensions) {
        const path = `/upload/ms.${ext}`;
        try {
          const res = await fetch(path, { method: 'HEAD' });
          if (res.ok) {
            document.body.style.backgroundImage = `url("${path}")`;
            document.body.style.backgroundColor = '#e2d1c3'
            document.body.style.backgroundSize = 'contain';
            document.body.style.backgroundPosition = 'center';
            document.body.style.backgroundRepeat = 'no-repeat';
            document.body.style.backgroundAttachment = 'fixed';
            break;
          }
        } catch (_) {
          // dosya yoksa denemeye devam
        }
      }
    });
  </script>
  <h1>üì∏ Merve & ≈û√ºkr√º Ni≈üan Anƒ±larƒ±</h1>
  <p>G√ºzel anƒ±larƒ±nƒ± bizimle payla≈ü!</p>
  <div id="fileCount"></div>
  <div id="drop-zone">
    <input type="file" id="fileInput" name="photos" accept="image/*,video/*" multiple />
    <button class="btn" id="selectBtn" onclick="document.getElementById('fileInput').click()">üìÅ Dosya Se√ß</button>
    <button class="btn" id="uploadBtn" onclick="uploadFiles()" disabled>‚¨ÜÔ∏è Y√ºkle</button>
    <button class="btn" id="showGalleryBtn" onclick="toggleGallery()">üìÇ Anƒ±larƒ± G√∂ster</button>
    <div id="preview-container"></div>
    <div id="status"></div>
    <div id="success-message">Katkƒ±nƒ±z i√ßin te≈üekk√ºr ederiz! üéâ</div>
  </div>
  <script>
    const input = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const previewContainer = document.getElementById("preview-container");
    const status = document.getElementById("status");
    const successMessage = document.getElementById("success-message");
    const fileCountEl = document.getElementById("fileCount");
    let selectedFiles = [];
    input.addEventListener("change", () => {
      const newFiles = Array.from(input.files);
      newFiles.forEach(file => {
        const exists = selectedFiles.some(f => f.name === file.name && f.size === file.size);
        if (!exists) {
          selectedFiles.push(file);
        }
      });
      input.value = "";
      updatePreview();
    });
    function updatePreview() {
      previewContainer.innerHTML = "";
      uploadBtn.disabled = selectedFiles.length === 0;
      if (selectedFiles.length === 0) {
        fileCountEl.innerText = "";
      } else {
        const photoCount = selectedFiles.filter(f => f.type.startsWith("image/")).length;
        const videoCount = selectedFiles.filter(f => f.type.startsWith("video/")).length;
        const parts = [];
        if (photoCount > 0) parts.push(`${photoCount} fotoƒüraf`);
        if (videoCount > 0) parts.push(`${videoCount} video`);
        fileCountEl.innerText = parts.join(" ve ") + " se√ßildi";
      }
      selectedFiles.forEach((file, index) => {
        const preview = document.createElement("div");
        preview.className = "preview";
        const removeBtn = document.createElement("button");
        removeBtn.className = "remove-btn";
        removeBtn.innerText = "√ó";
        removeBtn.onclick = () => {
          selectedFiles.splice(index, 1);
          updatePreview();
        };
        if (file.type.startsWith("image/")) {
          const img = document.createElement("img");
          img.src = URL.createObjectURL(file);
          preview.appendChild(img);
        } else if (file.type.startsWith("video/")) {
          const video = document.createElement("video");
          video.src = URL.createObjectURL(file);
          video.controls = true;
          preview.appendChild(video);
        }
        preview.appendChild(removeBtn);
        previewContainer.appendChild(preview);
      });
    }
    async function uploadFiles() {
      if (!selectedFiles.length) return alert('Dosya se√ßilmedi.');

      const formData = new FormData();
      for (const file of selectedFiles) {
        formData.append('media', file);
      }
      document.querySelectorAll(".remove-btn").forEach(btn => {
        btn.classList.add("disabled");
      });
      uploadBtn.disabled = true;
      uploadBtn.innerHTML = 'Y√ºkleniyor... <span class="loader"></span>';
      document.getElementById("selectBtn").disabled = true;
      document.getElementById("showGalleryBtn").disabled = true;

      try {
        const res = await fetch('/api/upload', {
          method: 'POST',
          body: formData
        });
        const result = await res.json();
        if (result.success) {
          successMessage.style.display = 'block';
          selectedFiles = [];
          updatePreview();
          setTimeout(() => {
            toggleGallery(); toggleGallery();
          }, 30000);
        } else {
          alert('Y√ºkleme hatasƒ±: ' + result.error);
        }
      } catch (err) {
        alert('Sunucu hatasƒ±: ' + err.message);
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.innerText = '‚¨ÜÔ∏è Y√ºkle';
        document.querySelectorAll(".remove-btn").forEach(btn => {
          btn.classList.remove("disabled");
        });
        document.getElementById("selectBtn").disabled = false;
        document.getElementById("showGalleryBtn").disabled = false;
      }
    }

  </script>
  <div id="gallery" style="display: none; margin-top: 30px;">
    <h3>Y√ºklenen Fotoƒüraf ve Videolar</h3>
    <div style="margin-bottom: 15px;">
      <button class="btn" onclick="downloadSelected()">‚¨áÔ∏è Se√ßilenleri ƒ∞ndir</button>
    </div>
    <div id="galleryContainer" style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;"></div>
  </div>

  <script>
    let allGalleryFiles = [];

    async function toggleGallery() {
      const gallery = document.getElementById("gallery");
      const container = document.getElementById("galleryContainer");

      if (gallery.style.display === "none") {
        gallery.style.display = "block";
        container.innerHTML = "";
        const res = await fetch('/uploads');
        const files = await res.json();
        allGalleryFiles = files;
        files.forEach(file => {
          const ext = file.split('.').pop().toLowerCase();
          const isImage = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext);
          const isVideo = ['mp4', 'mov', 'avi', 'webm'].includes(ext);
          const wrapper = document.createElement("div");
          wrapper.className = "gallery-item";
          wrapper.style.position = "relative";
          wrapper.style.width = "160px";
          wrapper.style.border = "1px solid #ccc";
          wrapper.style.borderRadius = "10px";
          wrapper.style.overflow = "hidden";
          wrapper.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
          wrapper.style.background = "#fff";
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.value = file;
          checkbox.className = "gallery-checkbox";
          checkbox.style.position = "absolute";
          checkbox.style.top = "5px";
          checkbox.style.left = "5px";
          checkbox.style.width = "20px";
          checkbox.style.height = "20px";
          checkbox.style.zIndex = "10";
          wrapper.appendChild(checkbox);
          if (isImage) {
            const img = document.createElement("img");
            img.src = `/uploads/${file}`;
            img.style.width = "100%";
            img.style.height = "120px";
            img.style.objectFit = "cover";
            wrapper.appendChild(img);
          } else if (isVideo) {
            const vid = document.createElement("video");
            vid.src = `/uploads/${file}`;
            vid.controls = true;
            vid.style.width = "100%";
            vid.style.height = "120px";
            wrapper.appendChild(vid);
          }
          container.appendChild(wrapper);
        });
      } else {
        gallery.style.display = "none";
      }
    }
    function downloadSelected() {
      const checkboxes = document.querySelectorAll('.gallery-checkbox:checked');
      if (checkboxes.length === 0) {
        alert("L√ºtfen indirilecek dosya(larƒ±) se√ßin.");
        return;
      }
      checkboxes.forEach(cb => {
        const link = document.createElement('a');
        link.href = `/uploads/${cb.value}`;
        link.download = cb.value;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
    }
  </script>
</body>

</html>